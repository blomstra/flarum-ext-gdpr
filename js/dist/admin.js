(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r),t.d(r,{extend:()=>W});const e=flarum.core.compat["admin/app"];var a=t.n(e);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["admin/components/UserListPage"];var s=t.n(o);const i=flarum.core.compat["common/utils/ItemList"];var l=t.n(i);const d=flarum.core.compat["common/components/Tooltip"];var p=t.n(d);const u=flarum.core.compat["common/components/Button"];var c=t.n(u);const f=flarum.core.compat["common/helpers/username"];var g=t.n(f);function h(t,r){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},h(t,r)}function y(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,h(t,r)}const _=flarum.core.compat["common/app"];var v=t.n(_);const b=flarum.core.compat["common/components/Modal"];var x=t.n(b);const N=flarum.core.compat["common/helpers/avatar"];var D=t.n(N),G=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).user=void 0,r}y(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.user=this.attrs.user},e.className=function(){return"RequestDataModal Modal--small"},e.title=function(){return v().translator.trans("flarum-gdpr.lib.request_data.title",{username:g()(this.user)})},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"User"},D()(this.user)),m("p",{className:"helpText"},v().translator.trans("flarum-gdpr.lib.request_data.text")),m("div",{className:"Form-group"},m(c(),{className:"Button Button--primary Button--block",onclick:function(){return t.requestExport()},loading:this.loading,disabled:this.loading},v().translator.trans("flarum-gdpr.lib.request_data.request_button")))))},e.requestExport=function(){this.loading=!0,v().request({method:"POST",url:v().forum.attribute("apiUrl")+"/gdpr/export",body:{data:{attributes:{userId:this.user.id()}}}}).then(this.hide.bind(this),this.loaded.bind(this))},r}(x());const w=flarum.core.compat["admin/components/AdminNav"];var A=t.n(w);const T=flarum.core.compat["common/components/LinkButton"];var O=t.n(T);const P=flarum.core.compat["common/extenders"];var z=t.n(P);const M=flarum.core.compat["common/models/User"];var S=t.n(M);const B=flarum.core.compat["common/Model"];var q=t.n(B),E=function(t){function r(){return t.apply(this,arguments)||this}y(r,t);var e=r.prototype;return e.status=function(){return q().attribute("status").call(this)},e.reason=function(){return q().attribute("reason").call(this)},e.createdAt=function(){return q().attribute("createdAt",q().transformDate).call(this)},e.userConfirmedAt=function(){return q().attribute("userConfirmedAt",q().transformDate).call(this)},e.processedAt=function(){return q().attribute("processedAt",q().transformDate).call(this)},e.processorComment=function(){return q().attribute("processorComment").call(this)},e.processedMode=function(){return q().attribute("processedMode").call(this)},e.user=function(){return q().hasOne("user").call(this)},e.processedBy=function(){return q().hasOne("processedBy").call(this)},r}(q()),j=function(t){function r(){return t.apply(this,arguments)||this}y(r,t);var e=r.prototype;return e.file=function(){return q().attribute("file").call(this)},e.createdAt=function(){return q().attribute("createdAt",q().transformDate)},e.destroysAt=function(){return q().attribute("destroysAt",q().transformDate)},e.user=function(){return q().hasOne("user")},e.actor=function(){return q().hasOne("actor")},r}(q());const C=[(new(z().Store)).add("user-erasure-requests",E).add("exports",j),new(z().Model)(S()).attribute("canModerateExports").attribute("anonymized").hasOne("erasureRequest")],I=flarum.core.compat["admin/components/AdminPage"];var U=t.n(I);const k=flarum.core.compat["common/components/LoadingIndicator"];var F=t.n(k);const L=flarum.core.compat["common/Component"];var R=t.n(L);const H=flarum.core.compat["common/helpers/icon"];var J=t.n(H),K=function(t){function r(){return t.apply(this,arguments)||this}return y(r,t),r.prototype.view=function(){var t=this.attrs.extension;return t?m(p(),{text:t.extra["flarum-extension"].title},m(O(),{href:a().route("extension",{id:t.id})},m("span",{className:"ExtensionIcon ExtensionIcon--gdpr",style:t.icon},!!t.icon&&J()(t.icon.name)))):null},r}(R()),Q=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).gdprDataTypes=[],r}y(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.loadGdprDataTypes()},e.headerInfo=function(){return{className:"GdprPage--header",icon:"fas fa-user-shield",title:a().translator.trans("flarum-gdpr.admin.gdpr_page.heading"),description:a().translator.trans("flarum-gdpr.admin.gdpr_page.description")}},e.loadGdprDataTypes=function(){var t=this;this.loading=!0,a().store.find("gdpr/datatypes").then((function(r){t.gdprDataTypes=r,t.loading=!1,m.redraw()}))},e.content=function(){return this.loading?m(F(),null):m("div",{className:"GdprPage"},m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.heading")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.help_text")),m(O(),{className:"Button",href:a().route("extension",{id:"flarum-gdpr"})},a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.extension_settings_button")),m("hr",null),m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.help_text")),m("div",{className:"GdprGrid"},m("div",{class:"GdprGrid-row"},m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.type")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.export_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.anonymize_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.delete_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.extension"))),this.gdprDataTypes.map((function(t){return m("[",null,m("div",{class:"GdprGrid-row"},m("div",null,m(p(),{text:t.id()},m("span",{className:"helpText"},t.type()))),m("div",{className:"helpText"},t.exportDescription()),m("div",{className:"helpText"},t.anonymizeDescription()),m("div",{className:"helpText"},t.deleteDescription()),m("div",null,m(K,{extension:a().data.extensions[t.extension()]}))))}))),m("hr",null),m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.user_table_data.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.user_table_data.help_text")),m("div",{className:"GdprUserColumnData"},"Not yet implemented"))},r}(U()),V=function(t){function r(){return t.apply(this,arguments)||this}y(r,t);var e=r.prototype;return e.type=function(){return q().attribute("type").call(this)},e.exportDescription=function(){return q().attribute("exportDescription").call(this)},e.anonymizeDescription=function(){return q().attribute("anonymizeDescription").call(this)},e.deleteDescription=function(){return q().attribute("deleteDescription").call(this)},e.extension=function(){return q().attribute("extension").call(this)},r}(q());const W=[].concat(C,[(new(z().Routes)).add("gdpr","/gdpr",Q),(new(z().Store)).add("gdpr-datatypes",V)]);a().initializers.add("flarum-gdpr",(function(){a().extensionData.for("flarum-gdpr").registerSetting((function(){return m("div",{className:"Form-group"},m("h3",null,a().translator.trans("flarum-gdpr.admin.settings.gdpr_page.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.settings.gdpr_page.help_text")),m(O(),{href:a().route("gdpr"),icon:"fas fa-user-shield",className:"Button"},a().translator.trans("flarum-gdpr.admin.nav.gdpr_button")))})).registerSetting({setting:"flarum-gdpr.allow-anonymization",label:a().translator.trans("flarum-gdpr.admin.settings.allow_anonymization"),help:a().translator.trans("flarum-gdpr.admin.settings.allow_anonymization_help"),type:"boolean"}).registerSetting({setting:"flarum-gdpr.allow-deletion",label:a().translator.trans("flarum-gdpr.admin.settings.allow_deletion"),help:a().translator.trans("flarum-gdpr.admin.settings.allow_deletion_help"),type:"boolean"}).registerSetting({setting:"flarum-gdpr.default-erasure",label:a().translator.trans("flarum-gdpr.admin.settings.default_erasure"),help:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_help"),type:"select",options:{anonymization:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_options.anonymization"),deletion:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_options.deletion")}}).registerSetting({setting:"flarum-gdpr.default-anonymous-username",type:"string",label:a().translator.trans("flarum-gdpr.admin.settings.default_anonymous_username"),help:a().translator.trans("flarum-gdpr.admin.settings.default_anonymous_username_help")}).registerPermission({icon:"fas fa-user-minus",label:a().translator.trans("flarum-gdpr.admin.permissions.process_erasure"),permission:"processErasure"},"moderate").registerPermission({icon:"fas fa-file-export",label:a().translator.trans("flarum-gdpr.admin.permissions.process_export_for_others"),permission:"moderateExport"},"moderate").registerPermission({icon:"fas fa-eye",label:a().translator.trans("flarum-gdpr.admin.permissions.see_anonymized_user_badges"),permission:"seeAnonymizedUserBadges",allowGuest:!0},"view"),(0,n.extend)(s().prototype,"columns",(function(t){var r=this;t.add("gdpr",{name:a().translator.trans("flarum-gdpr.admin.userlist.columns.gdpr_actions.title"),content:function(t){return m("div",{className:"gdprActions"},r.gdprActions(t).toArray())}},50)})),s().prototype.gdprActions=function(t){var r=new(l());return t.canModerateExports()&&r.add("export-data",m(p(),{text:a().translator.trans("flarum-gdpr.admin.userlist.columns.gdpr_actions.export",{username:g()(t)})},m(c(),{className:"Button Button--icon",icon:"fas fa-file-export",onclick:function(){return a().modal.show(G,{user:t})}}))),r},(0,n.extend)(A().prototype,"items",(function(t){t.add("gdpr",m(O(),{href:a().route("gdpr"),icon:"fas fa-user-shield",title:a().translator.trans("flarum-gdpr.admin.gdpr.title")},a().translator.trans("flarum-gdpr.admin.nav.gdpr_button")),48)}))}))})(),module.exports=r})();
//# sourceMappingURL=admin.js.map