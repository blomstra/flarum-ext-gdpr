(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var o in e)t.o(e,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:e[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r),t.d(r,{extend:()=>j});const e=flarum.core.compat["admin/app"];var o=t.n(e);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["admin/components/UserListPage"];var s=t.n(a);const i=flarum.core.compat["common/utils/ItemList"];var l=t.n(i);const u=flarum.core.compat["common/components/Tooltip"];var c=t.n(u);const d=flarum.core.compat["common/components/Button"];var p=t.n(d);const f=flarum.core.compat["common/helpers/username"];var b=t.n(f);function g(t,r){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},g(t,r)}function h(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,g(t,r)}const y=flarum.core.compat["common/app"];var _=t.n(y);const v=flarum.core.compat["common/components/Modal"];var x=function(t){function r(){for(var r,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(r=t.call.apply(t,[this].concat(o))||this).user=void 0,r}h(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.user=this.attrs.user},e.className=function(){return"RequestDataModal Modal--small"},e.title=function(){return _().translator.trans("blomstra-gdpr.lib.request_data.title",{username:b()(this.user)})},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},_().translator.trans("blomstra-gdpr.lib.request_data.text")),m("div",{className:"Form-group"},m(p(),{className:"Button Button--primary Button--block",onclick:function(){return t.requestExport()},loading:this.loading,disabled:this.loading},_().translator.trans("blomstra-gdpr.lib.request_data.request_button")))))},e.requestExport=function(){this.loading=!0,_().request({method:"POST",url:_().forum.attribute("apiUrl")+"/gdpr/export",body:{data:{attributes:{userId:this.user.id()}}}}).then(this.hide.bind(this),this.loaded.bind(this))},r}(t.n(v)());const O=flarum.core.compat["common/extenders"];var A=t.n(O);const w=flarum.core.compat["common/models/User"];var M=t.n(w);const q=flarum.core.compat["common/Model"];var P=t.n(q),S=function(t){function r(){return t.apply(this,arguments)||this}h(r,t);var e=r.prototype;return e.status=function(){return P().attribute("status").call(this)},e.reason=function(){return P().attribute("reason").call(this)},e.createdAt=function(){return P().attribute("createdAt",P().transformDate).call(this)},e.userConfirmedAt=function(){return P().attribute("userConfirmedAt",P().transformDate).call(this)},e.processedAt=function(){return P().attribute("processedAt",P().transformDate).call(this)},e.processorComment=function(){return P().attribute("processorComment").call(this)},e.processedMode=function(){return P().attribute("processedMode").call(this)},e.user=function(){return P().hasOne("user").call(this)},e.processedBy=function(){return P().hasOne("processedBy").call(this)},r}(P()),B=function(t){function r(){return t.apply(this,arguments)||this}h(r,t);var e=r.prototype;return e.file=function(){return P().attribute("file").call(this)},e.createdAt=function(){return P().attribute("createdAt",P().transformDate)},e.destroysAt=function(){return P().attribute("destroysAt",P().transformDate)},e.user=function(){return P().hasOne("user")},e.actor=function(){return P().hasOne("actor")},r}(P());const N=[(new(A().Store)).add("user-erasure-requests",S).add("exports",B),new(A().Model)(M()).attribute("canModerateExports").hasOne("erasureRequest")],j=[].concat(N);o().initializers.add("blomstra-gdpr",(function(){o().extensionData.for("blomstra-gdpr").registerSetting({setting:"blomstra-gdpr.allow-anonymization",label:o().translator.trans("blomstra-gdpr.admin.settings.allow_anonymization"),help:o().translator.trans("blomstra-gdpr.admin.settings.allow_anonymization_help"),type:"boolean"}).registerSetting({setting:"blomstra-gdpr.allow-deletion",label:o().translator.trans("blomstra-gdpr.admin.settings.allow_deletion"),help:o().translator.trans("blomstra-gdpr.admin.settings.allow_deletion_help"),type:"boolean"}).registerSetting({setting:"blomstra-gdpr.default-erasure",label:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure"),help:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure_help"),type:"select",options:{anonymization:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure_options.anonymization"),deletion:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure_options.deletion")}}).registerPermission({icon:"fas fa-user-minus",label:o().translator.trans("blomstra-gdpr.admin.permissions.process_erasure"),permission:"processErasure"},"moderate").registerPermission({icon:"fas fa-file-export",label:o().translator.trans("blomstra-gdpr.admin.permissions.process_export_for_others"),permission:"moderateExport"},"moderate"),(0,n.extend)(s().prototype,"columns",(function(t){var r=this;t.add("gdpr",{name:o().translator.trans("blomstra-gdpr.admin.userlist.columns.gdpr_actions.title"),content:function(t){return m("div",{className:"gdprActions"},r.gdprActions(t).toArray())}},50)})),s().prototype.gdprActions=function(t){var r=new(l());return r.add("export-data",m(c(),{text:o().translator.trans("blomstra-gdpr.admin.userlist.columns.gdpr_actions.export",{username:b()(t)})},m(p(),{className:"Button Button--icon",icon:"fas fa-file-export",onclick:function(){return o().modal.show(x,{user:t})}}))),r}}))})(),module.exports=r})();
//# sourceMappingURL=admin.js.map