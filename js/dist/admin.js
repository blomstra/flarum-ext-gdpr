(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var o in e)t.o(e,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:e[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r),t.d(r,{extend:()=>E});const e=flarum.core.compat["admin/app"];var o=t.n(e);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["admin/components/UserListPage"];var s=t.n(a);const i=flarum.core.compat["common/utils/ItemList"];var l=t.n(i);const c=flarum.core.compat["common/components/Tooltip"];var u=t.n(c);const d=flarum.core.compat["common/components/Button"];var p=t.n(d);const f=flarum.core.compat["common/helpers/username"];var b=t.n(f);function g(t,r){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},g(t,r)}function h(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,g(t,r)}const y=flarum.core.compat["common/app"];var v=t.n(y);const _=flarum.core.compat["common/components/Modal"];var x=t.n(_);const O=flarum.core.compat["common/helpers/avatar"];var A=t.n(O),w=function(t){function r(){for(var r,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(r=t.call.apply(t,[this].concat(o))||this).user=void 0,r}h(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.user=this.attrs.user},e.className=function(){return"RequestDataModal Modal--small"},e.title=function(){return v().translator.trans("blomstra-gdpr.lib.request_data.title",{username:b()(this.user)})},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"User"},A()(this.user)),m("p",{className:"helpText"},v().translator.trans("blomstra-gdpr.lib.request_data.text")),m("div",{className:"Form-group"},m(p(),{className:"Button Button--primary Button--block",onclick:function(){return t.requestExport()},loading:this.loading,disabled:this.loading},v().translator.trans("blomstra-gdpr.lib.request_data.request_button")))))},e.requestExport=function(){this.loading=!0,v().request({method:"POST",url:v().forum.attribute("apiUrl")+"/gdpr/export",body:{data:{attributes:{userId:this.user.id()}}}}).then(this.hide.bind(this),this.loaded.bind(this))},r}(x());const M=flarum.core.compat["common/extenders"];var q=t.n(M);const P=flarum.core.compat["common/models/User"];var S=t.n(P);const N=flarum.core.compat["common/Model"];var B=t.n(N),j=function(t){function r(){return t.apply(this,arguments)||this}h(r,t);var e=r.prototype;return e.status=function(){return B().attribute("status").call(this)},e.reason=function(){return B().attribute("reason").call(this)},e.createdAt=function(){return B().attribute("createdAt",B().transformDate).call(this)},e.userConfirmedAt=function(){return B().attribute("userConfirmedAt",B().transformDate).call(this)},e.processedAt=function(){return B().attribute("processedAt",B().transformDate).call(this)},e.processorComment=function(){return B().attribute("processorComment").call(this)},e.processedMode=function(){return B().attribute("processedMode").call(this)},e.user=function(){return B().hasOne("user").call(this)},e.processedBy=function(){return B().hasOne("processedBy").call(this)},r}(B()),D=function(t){function r(){return t.apply(this,arguments)||this}h(r,t);var e=r.prototype;return e.file=function(){return B().attribute("file").call(this)},e.createdAt=function(){return B().attribute("createdAt",B().transformDate)},e.destroysAt=function(){return B().attribute("destroysAt",B().transformDate)},e.user=function(){return B().hasOne("user")},e.actor=function(){return B().hasOne("actor")},r}(B());const z=[(new(q().Store)).add("user-erasure-requests",j).add("exports",D),new(q().Model)(S()).attribute("canModerateExports").hasOne("erasureRequest")],E=[].concat(z);o().initializers.add("blomstra-gdpr",(function(){o().extensionData.for("blomstra-gdpr").registerSetting({setting:"blomstra-gdpr.allow-anonymization",label:o().translator.trans("blomstra-gdpr.admin.settings.allow_anonymization"),help:o().translator.trans("blomstra-gdpr.admin.settings.allow_anonymization_help"),type:"boolean"}).registerSetting({setting:"blomstra-gdpr.allow-deletion",label:o().translator.trans("blomstra-gdpr.admin.settings.allow_deletion"),help:o().translator.trans("blomstra-gdpr.admin.settings.allow_deletion_help"),type:"boolean"}).registerSetting({setting:"blomstra-gdpr.default-erasure",label:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure"),help:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure_help"),type:"select",options:{anonymization:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure_options.anonymization"),deletion:o().translator.trans("blomstra-gdpr.admin.settings.default_erasure_options.deletion")}}).registerPermission({icon:"fas fa-user-minus",label:o().translator.trans("blomstra-gdpr.admin.permissions.process_erasure"),permission:"processErasure"},"moderate").registerPermission({icon:"fas fa-file-export",label:o().translator.trans("blomstra-gdpr.admin.permissions.process_export_for_others"),permission:"moderateExport"},"moderate"),(0,n.extend)(s().prototype,"columns",(function(t){var r=this;t.add("gdpr",{name:o().translator.trans("blomstra-gdpr.admin.userlist.columns.gdpr_actions.title"),content:function(t){return m("div",{className:"gdprActions"},r.gdprActions(t).toArray())}},50)})),s().prototype.gdprActions=function(t){var r=new(l());return r.add("export-data",m(u(),{text:o().translator.trans("blomstra-gdpr.admin.userlist.columns.gdpr_actions.export",{username:b()(t)})},m(p(),{className:"Button Button--icon",icon:"fas fa-file-export",onclick:function(){return o().modal.show(w,{user:t})}}))),r}}))})(),module.exports=r})();
//# sourceMappingURL=admin.js.map