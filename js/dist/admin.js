(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r),t.d(r,{extend:()=>K});const e=flarum.core.compat["admin/app"];var a=t.n(e);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["admin/components/UserListPage"];var s=t.n(o);const i=flarum.core.compat["common/utils/ItemList"];var l=t.n(i);const d=flarum.core.compat["common/components/Tooltip"];var p=t.n(d);const c=flarum.core.compat["common/components/Button"];var u=t.n(c);const f=flarum.core.compat["common/helpers/username"];var g=t.n(f);function h(t,r){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},h(t,r)}function b(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,h(t,r)}const y=flarum.core.compat["common/app"];var v=t.n(y);const _=flarum.core.compat["common/components/Modal"];var x=t.n(_);const N=flarum.core.compat["common/helpers/avatar"];var D=t.n(N),G=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).user=void 0,r}b(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.user=this.attrs.user},e.className=function(){return"RequestDataModal Modal--small"},e.title=function(){return v().translator.trans("blomstra-gdpr.lib.request_data.title",{username:g()(this.user)})},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"User"},D()(this.user)),m("p",{className:"helpText"},v().translator.trans("blomstra-gdpr.lib.request_data.text")),m("div",{className:"Form-group"},m(u(),{className:"Button Button--primary Button--block",onclick:function(){return t.requestExport()},loading:this.loading,disabled:this.loading},v().translator.trans("blomstra-gdpr.lib.request_data.request_button")))))},e.requestExport=function(){this.loading=!0,v().request({method:"POST",url:v().forum.attribute("apiUrl")+"/gdpr/export",body:{data:{attributes:{userId:this.user.id()}}}}).then(this.hide.bind(this),this.loaded.bind(this))},r}(x());const w=flarum.core.compat["admin/components/AdminNav"];var A=t.n(w);const O=flarum.core.compat["common/components/LinkButton"];var T=t.n(O);const P=flarum.core.compat["common/extenders"];var M=t.n(P);const B=flarum.core.compat["common/models/User"];var S=t.n(B);const q=flarum.core.compat["common/Model"];var z=t.n(q),C=function(t){function r(){return t.apply(this,arguments)||this}b(r,t);var e=r.prototype;return e.status=function(){return z().attribute("status").call(this)},e.reason=function(){return z().attribute("reason").call(this)},e.createdAt=function(){return z().attribute("createdAt",z().transformDate).call(this)},e.userConfirmedAt=function(){return z().attribute("userConfirmedAt",z().transformDate).call(this)},e.processedAt=function(){return z().attribute("processedAt",z().transformDate).call(this)},e.processorComment=function(){return z().attribute("processorComment").call(this)},e.processedMode=function(){return z().attribute("processedMode").call(this)},e.user=function(){return z().hasOne("user").call(this)},e.processedBy=function(){return z().hasOne("processedBy").call(this)},r}(z()),j=function(t){function r(){return t.apply(this,arguments)||this}b(r,t);var e=r.prototype;return e.file=function(){return z().attribute("file").call(this)},e.createdAt=function(){return z().attribute("createdAt",z().transformDate)},e.destroysAt=function(){return z().attribute("destroysAt",z().transformDate)},e.user=function(){return z().hasOne("user")},e.actor=function(){return z().hasOne("actor")},r}(z());const k=[(new(M().Store)).add("user-erasure-requests",C).add("exports",j),new(M().Model)(S()).attribute("canModerateExports").hasOne("erasureRequest")],E=flarum.core.compat["admin/components/AdminPage"];var U=t.n(E);const I=flarum.core.compat["common/components/LoadingIndicator"];var L=t.n(I);const F=flarum.core.compat["common/Component"];var R=function(t){function r(){return t.apply(this,arguments)||this}return b(r,t),r.prototype.view=function(){var t,r,e,n=this.attrs.extension;if(!n)return null;var o=null==(t=n.icon)?void 0:t.name,s=(null==(r=n.icon)?void 0:r.backgroundColor)||"transparent",i=(null==(e=n.icon)?void 0:e.color)||"#000";return m(p(),{text:n.extra["flarum-extension"].title},m(T(),{className:"Button Button--icon",icon:o,href:a().route("extension",{id:n.id}),style:{backgroundColor:s,color:i}}))},r}(t.n(F)()),H=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).gdprDataTypes=[],r}b(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.loadGdprDataTypes()},e.headerInfo=function(){return{className:"GdprPage--header",icon:"fas fa-user-shield",title:a().translator.trans("blomstra-gdpr.admin.gdpr_page.heading"),description:a().translator.trans("blomstra-gdpr.admin.gdpr_page.description")}},e.loadGdprDataTypes=function(){var t=this;this.loading=!0,a().store.find("gdpr/datatypes").then((function(r){t.gdprDataTypes=r,t.loading=!1,m.redraw()}))},e.content=function(){return this.loading?m(L(),null):m("div",{className:"GdprPage"},m("h3",null,a().translator.trans("blomstra-gdpr.admin.gdpr_page.data_types.title")),m("p",{className:"helpText"},a().translator.trans("blomstra-gdpr.admin.gdpr_page.data_types.help_text")),m("div",{className:"GdprGrid"},m("div",{class:"GdprGrid-row"},m("div",{className:"GdprGrid-header"},a().translator.trans("blomstra-gdpr.admin.gdpr_page.data_types.type")),m("div",{className:"GdprGrid-header"},a().translator.trans("blomstra-gdpr.admin.gdpr_page.data_types.export_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("blomstra-gdpr.admin.gdpr_page.data_types.anonymize_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("blomstra-gdpr.admin.gdpr_page.data_types.delete_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("blomstra-gdpr.admin.gdpr_page.data_types.extension"))),this.gdprDataTypes.map((function(t){return m("[",null,m("div",{class:"GdprGrid-row"},m("div",null,m(p(),{text:t.id()},m("span",{className:"helpText"},t.type()))),m("div",{className:"helpText"},t.exportDescription()),m("div",{className:"helpText"},t.anonymizeDescription()),m("div",{className:"helpText"},t.deleteDescription()),m("div",null,m(R,{extension:a().data.extensions[t.extension()]}))))}))),m("h3",null,a().translator.trans("blomstra-gdpr.admin.gdpr_page.user_table_data.title")),m("p",{className:"helpText"},a().translator.trans("blomstra-gdpr.admin.gdpr_page.user_table_data.help_text")),m("div",{className:"GdprUserColumnData"},"Not yet implemented"))},r}(U()),J=function(t){function r(){return t.apply(this,arguments)||this}b(r,t);var e=r.prototype;return e.type=function(){return z().attribute("type").call(this)},e.exportDescription=function(){return z().attribute("exportDescription").call(this)},e.anonymizeDescription=function(){return z().attribute("anonymizeDescription").call(this)},e.deleteDescription=function(){return z().attribute("deleteDescription").call(this)},e.extension=function(){return z().attribute("extension").call(this)},r}(z());const K=[].concat(k,[(new(M().Routes)).add("gdpr","/gdpr",H),(new(M().Store)).add("gdpr-datatypes",J)]);a().initializers.add("blomstra-gdpr",(function(){a().extensionData.for("blomstra-gdpr").registerSetting({setting:"blomstra-gdpr.allow-anonymization",label:a().translator.trans("blomstra-gdpr.admin.settings.allow_anonymization"),help:a().translator.trans("blomstra-gdpr.admin.settings.allow_anonymization_help"),type:"boolean"}).registerSetting({setting:"blomstra-gdpr.allow-deletion",label:a().translator.trans("blomstra-gdpr.admin.settings.allow_deletion"),help:a().translator.trans("blomstra-gdpr.admin.settings.allow_deletion_help"),type:"boolean"}).registerSetting({setting:"blomstra-gdpr.default-erasure",label:a().translator.trans("blomstra-gdpr.admin.settings.default_erasure"),help:a().translator.trans("blomstra-gdpr.admin.settings.default_erasure_help"),type:"select",options:{anonymization:a().translator.trans("blomstra-gdpr.admin.settings.default_erasure_options.anonymization"),deletion:a().translator.trans("blomstra-gdpr.admin.settings.default_erasure_options.deletion")}}).registerPermission({icon:"fas fa-user-minus",label:a().translator.trans("blomstra-gdpr.admin.permissions.process_erasure"),permission:"processErasure"},"moderate").registerPermission({icon:"fas fa-file-export",label:a().translator.trans("blomstra-gdpr.admin.permissions.process_export_for_others"),permission:"moderateExport"},"moderate"),(0,n.extend)(s().prototype,"columns",(function(t){var r=this;t.add("gdpr",{name:a().translator.trans("blomstra-gdpr.admin.userlist.columns.gdpr_actions.title"),content:function(t){return m("div",{className:"gdprActions"},r.gdprActions(t).toArray())}},50)})),s().prototype.gdprActions=function(t){var r=new(l());return r.add("export-data",m(p(),{text:a().translator.trans("blomstra-gdpr.admin.userlist.columns.gdpr_actions.export",{username:g()(t)})},m(u(),{className:"Button Button--icon",icon:"fas fa-file-export",onclick:function(){return a().modal.show(G,{user:t})}}))),r},(0,n.extend)(A().prototype,"items",(function(t){t.add("gdpr",m(T(),{href:a().route("gdpr"),icon:"fas fa-user-shield",title:a().translator.trans("blomstra-gdpr.admin.gdpr.title")},a().translator.trans("blomstra-gdpr.admin.nav.gdpr_button")),48)}))}))})(),module.exports=r})();
//# sourceMappingURL=admin.js.map